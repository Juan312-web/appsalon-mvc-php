let step=1;const initialStep=1,endStep=3,cita={id:"",nombre:"",fecha:"",hora:"",servicios:[]};function initApp(){showSection(),tabs(),buttonPagination(),nextPage(),previousPage(),consultAPI(),nameClient(),idClient(),selectedDate(),selectedHour(),showSummary()}function showSection(){const e=document.querySelector(".show");e&&e.classList.remove("show");const t=`#step-${step}`;document.querySelector(t).classList.add("show");const n=document.querySelector(".current");n&&n.classList.remove("current");const o=`[data-step="${step}"]`;document.querySelector(o).classList.add("current")}function tabs(){document.querySelectorAll(".tabs button").forEach((e=>{e.addEventListener("click",(e=>{let t=parseInt(e.target.dataset.step);step=t,showSection(),buttonPagination()}))}))}function buttonPagination(){const e=document.querySelector("#previuos"),t=document.querySelector("#next");1===step?(e.classList.add("hide"),t.classList.remove("hide")):3===step?(e.classList.remove("hide"),t.classList.add("hide"),showSummary()):(e.classList.remove("hide"),t.classList.remove("hide")),showSection()}function previousPage(){document.querySelector("#previuos").addEventListener("click",(()=>{step<=initialStep||(step--,buttonPagination())}))}function nextPage(){document.querySelector("#next").addEventListener("click",(()=>{step>=endStep||(step++,buttonPagination())}))}async function consultAPI(){try{const e=`${location.origin}/api/servicios`,t=await fetch(e);showServices(await t.json())}catch(e){}}function showServices(e){e.forEach((e=>{const{id:t,nombre:n,precio:o}=e,c=document.createElement("P");c.classList.add("name-service"),c.textContent=n;const a=document.createElement("P");a.classList.add("price-service"),a.textContent=`$${o}`;const i=document.createElement("DIV");i.classList.add("service"),i.dataset.idServicio=t,i.appendChild(c),i.appendChild(a),i.onclick=()=>{selectedService(e)},document.querySelector("#services").appendChild(i)}))}function selectedService(e){const{servicios:t}=cita,{id:n}=e,o=document.querySelector(`[data-id-servicio="${n}"]`);t.some((e=>e.id===n))?(cita.servicios=t.filter((e=>e.id!==n)),o.classList.remove("selected")):(cita.servicios=[...t,e],o.classList.add("selected"))}function nameClient(){cita.nombre=document.querySelector("#nombre").value}function idClient(){cita.id=document.querySelector("#id").value}function selectedDate(){document.querySelector("#fecha").addEventListener("input",(e=>{const t=new Date(e.target.value).getUTCDay();[6,0].includes(t)?(e.target.value="",showAlert("Fines de Semana no permitidos","error",".form")):cita.fecha=e.target.value}))}function selectedHour(){document.querySelector("#hora").addEventListener("input",(e=>{const t=e.target.value.split(":")[0];t<10||t>18?(e.target.value="",showAlert("Horario solo entre 11:00 y 16:00","error",".form")):(cita.hora=e.target.value,console.log(cita))}))}function showAlert(e,t,n,o=!0){const c=document.querySelector(".alerta");c&&c.remove();const a=document.createElement("DIV");a.textContent=e,a.classList.add("alerta"),a.classList.add(t);document.querySelector(n).appendChild(a),o&&setTimeout((()=>{a.remove()}),3e3)}function showSummary(){const{nombre:e,fecha:t,hora:n,servicios:o}=cita,c=document.querySelector(".container-summary");for(;c.firstChild;)c.removeChild(c.firstChild);if(Object.values(cita).includes("")||cita.servicios.length<1)return void showAlert("Faltan Datos de servicios, Fecha u Hora","error",".container-summary",!1);const a=document.createElement("H3");a.textContent="Resumen de Servicios",c.appendChild(a),o.forEach((e=>{const{id:t,precio:n,nombre:o}=e,a=document.createElement("DIV");a.classList.add("container-service");const i=document.createElement("P");i.textContent=o;const s=document.createElement("P");s.innerHTML=`<span>Precio: </span> $${n}`,a.appendChild(i),a.appendChild(s),c.appendChild(a)}));const i=document.createElement("H3");i.textContent="Resumen de Cita",c.appendChild(i);const s=document.createElement("P");s.innerHTML=`<span>Nombre:</span> ${e}`;const r=document.createElement("P");r.innerHTML=`<span>Fecha:</span> ${t}`;const d=new Date(t),l=d.getMonth(),u=d.getDate()+2,m=d.getFullYear(),p=new Date(Date.UTC(m,l,u)).toLocaleDateString("es-CO",{weekday:"long",year:"numeric",month:"long",day:"numeric"});console.log(p);const h=document.createElement("P");h.innerHTML=`<span>Hora:</span> ${n} Horas`,c.appendChild(s),c.appendChild(r),c.appendChild(h);const v=document.createElement("BUTTON");v.classList.add("boton"),v.textContent="Reservar Cita",v.onclick=reserveAppointment,c.appendChild(v)}async function reserveAppointment(){const{id:e,fecha:t,hora:n,servicios:o}=cita,c=o.map((e=>e.id)),a=new FormData;a.append("fecha",t),a.append("hora",n),a.append("usuarioId",e),a.append("servicios",c);try{const e=`${location.origin}/api/citas`,t=await fetch(e,{method:"POST",body:a});(await t.json()).resultado&&Swal.fire({icon:"success",title:"Cita Creada",text:"Tu Cita Fue Creada Con Exito!"}).then((()=>{window.location.reload()}))}catch(e){Swal.fire({icon:"error",title:"Oops...",text:"Algo a salido mal al guardar tu cita!"})}}document.addEventListener("DOMContentLoaded",(function(){initApp()}));